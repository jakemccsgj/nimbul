<%= f.error_messages %>

<%
if @task.task_parameters.size == 0
    @parameters = @task.initialize_parameters
else
    @parameters = @task.task_parameters
end
%>

<table>
    <tr>
        <th><%= f.label :is_active, "Active?" %></th>
        <td class="<%= @task.is_active? %>"><%= f.check_box :is_active %></td>
    </tr>
    <tr>
        <th><%= f.label :is_scheduled, "Scheduled?" %></th>
        <td class="<%= @task.is_scheduled? %>">
            <%= @task.is_scheduled? ? 'Yes' : (@task.is_active? ? 'Pending' : 'No' ) %>
            <%= hidden_field_tag 'task[is_scheduled]', 0 %>
        </td>
    </tr>
    <tr>
        <th><%= f.label :name %></th>
        <td><%= f.text_field :name %></td>
    </tr>
    <tr>
        <th><%= f.label :description %></th>
        <td><%= f.text_area :description, :size => '60x6', :warp => 'soft' %></td>
    </tr>
    <tr>
        <th>Operation</th>
        <td><%= h @task.operation %></td>
        <%= f.hidden_field :operation %>
    </tr>
    <tr>
        <th><%= f.label :ran_at, 'First Run' %></th>
        <td><%= f.datetime_select :run_at %></td>
    </tr>
    <tr>
        <th><%= f.label :is_repeatable, 'Repeat' %>
            <%= f.check_box :is_repeatable, :onclick => "
            if (!$(this).checked) {
                $('task_run_every_value').value = '';
            }
            $('task_run_every_value').disabled = !$(this).checked;
            $('task_run_every_units').disabled = !$(this).checked;
            " %>
        </th>
        <td>
            <%= f.text_field :run_every_value, :class => 'tiny', :disabled => !@task.is_repeatable? %>
            <%= f.select :run_every_units, RUN_EVERY_UNITS, { :disabled => !@task.is_repeatable? } %>
        </td>
    </tr>
    <% @parameters.each do |p| %>
        <% fields_for "task[task_parameter_attributes][]", p do |p_form| %>
            <tr>
                <th>
                    <%=h p.name.titleize %>
                    <% unless p.description.blank? %>
                        <small><br /><%=h p.description %> </small>
                    <% end %>
                </th>
                <% unless p.new_record? %>
                    <%= p_form.hidden_field :id, :index => nil %>
                <% end %>
                <%= p_form.hidden_field :name, :index => nil %>
                <%= p_form.hidden_field :description, :index => nil %>
                <%= p_form.hidden_field :control_type, :index => nil %>
                <td>
                    <%= p_form.text_field :value, :index => nil %>
                </td>
            </td>
        <% end %>
    <% end %>
</table>
